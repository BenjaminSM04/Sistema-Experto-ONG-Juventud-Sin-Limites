@implements IDisposable

@inject NavigationManager NavigationManager

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">ONG Juventud Sin Límites</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        <!-- HOME - Visible para todos los autenticados -->
    <AuthorizeView>
  <Authorized>
         <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
    <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Inicio
              </NavLink>
    </div>
     </Authorized>
        </AuthorizeView>

        <!-- SECCIÓN: ADMINISTRACIÓN -->
    <AuthorizeView Roles="Administrador">
            <div class="nav-section-header px-3 mt-3">
     <span class="section-title">Administración</span>
    </div>

  <div class="nav-item px-3">
       <NavLink class="nav-link" href="admin/usuarios">
 <span class="bi bi-people-fill" aria-hidden="true"></span> Gestión de Usuarios
     </NavLink>
    </div>
        </AuthorizeView>

        <!-- SECCIÓN: MOTOR DE INFERENCIA -->
        <AuthorizeView Roles="Administrador,Coordinador">
            <div class="nav-section-header px-3 mt-3">
          <span class="section-title">Motor de Inferencia</span>
 </div>

       <div class="nav-item px-3">
        <NavLink class="nav-link" href="admin/motor">
<span class="bi bi-gear-fill-nav-menu" aria-hidden="true"></span> Panel del Motor
     </NavLink>
   </div>
  </AuthorizeView>

        <!-- SECCIÓN: PROGRAMAS (Visible para todos los roles autenticados) -->
        <AuthorizeView>
            <Authorized>
<div class="nav-section-header px-3 mt-3">
       <span class="section-title">Programas</span>
              </div>

       <!-- TODO: Agregar enlaces a páginas de programas cuando estén disponibles -->
       <div class="nav-item px-3">
    <NavLink class="nav-link" href="programas" Match="NavLinkMatch.Prefix">
    <span class="bi bi-folder-fill" aria-hidden="true"></span> Ver Programas
       </NavLink>
           </div>
         </Authorized>
        </AuthorizeView>

   <!-- SECCIÓN: CUENTA -->
        <AuthorizeView>
            <Authorized>
    <div class="nav-section-header px-3 mt-4">
                  <span class="section-title">Mi Cuenta</span>
        </div>

            <div class="nav-item px-3">
     <NavLink class="nav-link" href="Account/Manage">
            <span class="bi bi-person-fill-nav-menu" aria-hidden="true"></span> @context.User.Identity?.Name
              </NavLink>
           </div>

    <div class="nav-item px-3">
 <NavLink class="nav-link" href="Account/Logout">
   <span class="bi bi-arrow-bar-left-nav-menu" aria-hidden="true"></span> Cerrar Sesión
   </NavLink>
       </div>
            </Authorized>
            <NotAuthorized>
        <div class="nav-item px-3">
<NavLink class="nav-link" href="Account/Login">
<span class="bi bi-person-badge-nav-menu" aria-hidden="true"></span> Iniciar Sesión
      </NavLink>
              </div>
   </NotAuthorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
     currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
 NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
  currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
      StateHasChanged();
    }

    public void Dispose()
    {
  NavigationManager.LocationChanged -= OnLocationChanged;
    }
}

